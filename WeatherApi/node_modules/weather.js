var express = require('express');
var request = require("request");
var router = express.Router();

// middleware specific to this router
router.use(function timeLog(req, res, next) {
  console.log('Time: ', Date.now());
  next();
});
// define the home page route
router.get('/', function(req, res) {
  res.send('Weather home page');
});
// define the temperature route
router.get('/temperature', function(req, res) {
	var zip=req.param('zipcode');
	var postUrl = "http://api.openweathermap.org/data/2.5/weather?zip=" + zip + ",us&APPID=240feac5f7a9c0d231bd0a220cd4ea64&units=metric"
	request.get(postUrl, function (error, response, body) {
		if (!error) {
			var resultsObj = JSON.parse(body);
			if(resultsObj.cod == '200'){
				var weatherObject = {
					name: resultsObj.name,
					humidity: resultsObj.main.humidity,
					tempMax: resultsObj.main.temp_max,
					tempMin: resultsObj.main.temp_min,
					pressure: resultsObj.main.pressure
				};
				res.status(200).send(weatherObject);
			}
			else{
				res.status(404).send('City not found');
			}
		}
	});
});

module.exports = router;